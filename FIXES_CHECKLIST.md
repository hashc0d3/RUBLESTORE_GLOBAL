# ‚úÖ –°–ü–ò–°–û–ö –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ò –ù–û–í–´–• –§–ê–ô–õ–û–í

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–û–î–ê (2 —Ñ–∞–π–ª–∞)

### 1. `/apps/web/src/migrations/20260204_000001.ts`
```diff
- import type { MigrateUpArgs, MigrateDownArgs } from '@payloadcms/db-postgres';
- function esc(s: string): string {
-   return s.replace(/'/g, "''");
- }

+ import type { MigrateUpArgs } from '@payloadcms/db-postgres';

- sql.raw(`INSERT INTO "categories" VALUES ('${name.replace(/'/g, "''")}', ...)`)
+ sql`INSERT INTO "categories" VALUES (${name}, ...)`

- const slugs = SEED_CATEGORIES.map((c) => `'${c.slug.replace(/'/g, "''")}'`).join(', ');
- sql.raw(`DELETE FROM "categories" WHERE "slug" IN (${slugs})`)
+ for (const slug of slugs) {
+   await db.execute(sql`DELETE FROM "categories" WHERE "slug" = ${slug}`)
+ }
```

### 2. `/apps/web/src/migrations/20260204_000002.ts`
```diff
- import type { MigrateUpArgs, MigrateDownArgs } from '@payloadcms/db-postgres';
- function esc(s: string): string {
-   return s.replace(/'/g, "''");
- }

+ import type { MigrateUpArgs } from '@payloadcms/db-postgres';

- const title = "'" + esc(p.title) + "'";
- sql.raw(`INSERT INTO "products" VALUES (${title}, ...)`)
+ sql`INSERT INTO "products" VALUES (${p.title}, ...)`

- const slugs = SEED_PRODUCTS.map((p) => `'${esc(p.slug)}'`).join(', ');
- sql.raw(`DELETE FROM "products" WHERE "slug" IN (${slugs})`)
+ for (const p of SEED_PRODUCTS) {
+   await db.execute(sql`DELETE FROM "products" WHERE "slug" = ${p.slug}`)
+ }
```

---

## üê≥ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø DOCKER (1 —Ñ–∞–π–ª)

### 3. `/docker-compose.yml`
```diff
  postgres:
-   ports:
-     - "5433:5432"
+   expose:
+     - "5432"

-   environment:
-     POSTGRES_PASSWORD: postgres
+   environment:
+     POSTGRES_PASSWORD: ${DB_PASSWORD:-change-me-in-production-very-secure-password}

+   command:
+     - "postgres"
+     - "-c"
+     - "log_statement=all"
+     - "-c"
+     - "log_duration=on"

  api:
-   DATABASE_URL: postgresql://postgres:postgres@postgres:5432/ruble_store
+   DATABASE_URL: postgresql://postgres:${DB_PASSWORD:-...}@postgres:5432/ruble_store
+   networks:
+     - default

  web:
-   DATABASE_URL: postgresql://postgres:postgres@postgres:5432/ruble_store
+   DATABASE_URL: postgresql://postgres:${DB_PASSWORD:-...}@postgres:5432/ruble_store
+   networks:
+     - default
```

---

## üìÑ –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ö–û–ù–§–ò–ì–ò (3 —Ñ–∞–π–ª–∞)

### 4. `/.env.example`
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û" –≤ –Ω–∞—á–∞–ª–æ
- –ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DB_PASSWORD` –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏–ª—å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 5. `/docs/ENV_SETUP.md`
- –†–∞–∑–¥–µ–ª "–î–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ Docker Compose" –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û
- –û–±—ä—è—Å–Ω–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DB_PASSWORD`
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SQL-injection –∞—Ç–∞–∫–∞—Ö

### 6. `/README.md`
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª "üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
- –°—Å—ã–ª–∫–∞ –Ω–∞ `SECURITY.md`
- –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∑–∞—â–∏—Ç—ã
- –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## üìö –ù–û–í–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (9 —Ñ–∞–π–ª–æ–≤)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å)

#### 7. `README_CRITICAL_UPDATE.md` ‚≠ê‚≠ê‚≠ê
- TL;DR - —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ –≤ 30 —Å–µ–∫—É–Ω–¥
- –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏
- –ö–∞–∫ —ç—Ç–æ –±—ã–ª–æ –∏ –∫–∞–∫ —ç—Ç–æ —Å—Ç–∞–ª–æ
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

#### 8. `QUICKSTART_CHECKLIST.md` ‚≠ê‚≠ê‚≠ê
- 6 —à–∞–≥–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (5-10 –º–∏–Ω—É—Ç)
- –†–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ "–ù–ò–ö–û–ì–î–ê" –∏ "–í–°–ï–ì–î–ê"

#### 9. `DOCUMENTATION_INDEX.md` ‚≠ê‚≠ê‚≠ê
- –ò–Ω–¥–µ–∫—Å –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ú–∞—Ç—Ä–∏—Ü–∞ "–ß—Ç–æ —á–∏—Ç–∞—Ç—å –∏ –∫–æ–≥–¥–∞"

### –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### 10. `SECURITY_FIX_SUMMARY.md`
- –†–µ–∑—é–º–µ –≤—Å–µ—Ö 4 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- –î–æ –∏ –ø–æ—Å–ª–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã
- –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
- –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

#### 11. `SECURITY.md`
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SQL Injection
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –ø–æ—Ä—Ç–∞
- –ü–æ—á–µ–º—É —Å–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏ –æ–ø–∞—Å–Ω—ã
- –ß–µ–∫-–ª–∏—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ö–∞–∫ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∞—Ç–∞–∫–∏ –≤ –ª–æ–≥–∞—Ö
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

#### 12. `DEPLOYMENT.md`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker —Å –Ω—É–ª—è
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–¥—ë–∂–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ .env
- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx + HTTPS
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

#### 13. `INCIDENT_RESPONSE.md`
- –®–∞–≥ 1: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (2-5 –º–∏–Ω—É—Ç)
- –®–∞–≥ 2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î (10-15 –º–∏–Ω—É—Ç)
- –®–∞–≥ 3: –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π –∏ –∫–ª—é—á–µ–π (5-10 –º–∏–Ω—É—Ç)
- –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã –∞—Ç–∞–∫–∏ (30+ –º–∏–Ω—É—Ç)
- –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- –®–∞–≥ 6: –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–µ–∫–∞–ø–æ–≤
- –®–∞–≥ 8: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### 14. `CHANGES_SUMMARY.md`
- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ
- –¢–∞–±–ª–∏—Ü–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ
- –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ñ–∞–π–ª—ã

#### 15. `COMMIT_MESSAGE.md`
- –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è commit message
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ü–æ—á–µ–º—É –∫–∞–∂–¥–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

---

## üõ†Ô∏è –ù–û–í–´–ï –°–ö–†–ò–ü–¢–´ (1 —Ñ–∞–π–ª)

### 16. `/scripts/security-check.sh` (–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Å–∫—Ä–∏–ø—Ç)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ .env
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª–µ–π (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ docker-compose.yml –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ docker-compose.yml –Ω–∞ –∂—ë—Å—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ CVE –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ firewall –ø—Ä–∞–≤–∏–ª–∞–º
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Å –∏—Ç–æ–≥–æ–≤—ã–º —Å—Ç–∞—Ç—É—Å–æ–º

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –°—Ç–∞—Ç—É—Å |
|-----------|-----------|--------|
| –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∫–æ–¥–∞ | 2 | ‚úÖ |
| –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ | 1 | ‚úÖ |
| –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 3 | ‚úÖ |
| –ù–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 9 | ‚úÖ |
| –ù–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ | 1 | ‚úÖ |
| **–ò–¢–û–ì–û –§–ê–ô–õ–û–í** | **16** | ‚úÖ |
| –°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | 1800+ | ‚úÖ |
| –û—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ | 0 | ‚úÖ |

---

## üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –í–ù–ï–î–†–ï–ù–ò–Æ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
git pull origin main
pnpm install  # –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –®–∞–≥ 2: –ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (5 –º–∏–Ω—É—Ç)
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º: `SECURITY.md` —Ä–∞–∑–¥–µ–ª "1. SQL Injection"
- DevOps: `QUICKSTART_CHECKLIST.md`
- –ú–µ–Ω–µ–¥–∂–µ—Ä–∞–º: `README_CRITICAL_UPDATE.md`

### –®–∞–≥ 3: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ production (15 –º–∏–Ω—É—Ç)
–°–ª–µ–¥–æ–≤–∞—Ç—å: `QUICKSTART_CHECKLIST.md`

---

## üîê –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

‚ùå **–ù–ò–ö–û–ì–î–ê:**
```typescript
sql.raw(`SELECT * FROM users WHERE id = '${user_id}'`)  // ‚ùå SQL INJECTION!
```

‚úÖ **–í–°–ï–ì–î–ê:**
```typescript
sql`SELECT * FROM users WHERE id = ${user_id}`  // ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
```

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

- [x] SQL Injection –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–û
- [x] –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç PostgreSQL - –ò–°–ü–†–ê–í–õ–ï–ù–û
- [x] –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å –ë–î - –ò–°–ü–†–ê–í–õ–ï–ù–û
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –°–û–ó–î–ê–ù–ê
- [x] –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –°–û–ó–î–ê–ù
- [x] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é - –ù–ê–ü–ò–°–ê–ù–´
- [x] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è - –ü–û–î–ì–û–¢–û–í–õ–ï–ù–ê

**–ì–û–¢–û–í–û –ö PRODUCTION** ‚úÖ

---

**–î–∞—Ç–∞:** 8 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0 (Production Ready)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

