# üìã –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 8 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–¢–∏–ø:** SQL Injection + –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üéØ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

### 1. **SQL Injection –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö** üî¥ ‚Üí ‚úÖ

#### –ü—Ä–æ–±–ª–µ–º–∞
–ú–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –¥–ª—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤:
```typescript
// ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û - –ø–æ–∑–≤–æ–ª—è–µ—Ç SQL injection
const title = "'" + esc(p.title) + "'";
sql.raw(`INSERT INTO "products" (...) VALUES (${title}, ...)`)
```

#### –†–µ—à–µ–Ω–∏–µ
–ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```typescript
// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - SQL injection –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
sql`INSERT INTO "products" (...) VALUES (${p.title}, ...)`
```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `/apps/web/src/migrations/20260204_000001.ts` (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- `/apps/web/src/migrations/20260204_000002.ts` (—Ç–æ–≤–∞—Ä—ã)

---

### 2. **–û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç PostgreSQL** üî¥ ‚Üí ‚úÖ

#### –ü—Ä–æ–±–ª–µ–º–∞
Docker-compose –æ—Ç–∫—Ä—ã–≤–∞–ª –ø–æ—Ä—Ç 5433 –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:
```yaml
# ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û - –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º—É –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
ports:
  - "5433:5432"
```

–õ–æ–≥ –∞—Ç–∞–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ø—ã—Ç–∫—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç.

#### –†–µ—à–µ–Ω–∏–µ
–ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `expose` - –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```yaml
# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - –ë–î –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Docker —Å–µ—Ç–∏
expose:
  - "5432"
```

**–§–∞–π–ª:** `/docker-compose.yml`

---

### 3. **–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å PostgreSQL** üî¥ ‚Üí ‚úÖ

#### –ü—Ä–æ–±–ª–µ–º–∞
–ü–∞—Ä–æ–ª—å `postgres` –∂—ë—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤–µ–∑–¥–µ:
```yaml
# ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û - —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
POSTGRES_PASSWORD: postgres
```

#### –†–µ—à–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å 32+ —Å–∏–º–≤–æ–ª—å–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º:
```yaml
# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - –ø–∞—Ä–æ–ª—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
POSTGRES_PASSWORD: ${DB_PASSWORD:-change-me-in-production-very-secure-password}
```

**–§–∞–π–ª—ã:**
- `/docker-compose.yml` (3 –º–µ—Å—Ç–∞)
- `/.env.example` (—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏)
- `/docs/ENV_SETUP.md` (—Å –ø—Ä–∏–º–µ—Ä–∞–º–∏)

---

### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** üî¥ ‚Üí ‚úÖ

#### –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| **SECURITY.md** | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —á–µ–∫-–ª–∏—Å—Ç—ã |
| **INCIDENT_RESPONSE.md** | –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∞—Ç–∞–∫–µ |
| **DEPLOYMENT.md** | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä |
| **scripts/security-check.sh** | –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º |

---

## üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

```
‚úÖ SQL Injection –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö         –ò–°–ü–†–ê–í–õ–ï–ù–û
‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç PostgreSQL          –ò–°–ü–†–ê–í–õ–ï–ù–û
‚úÖ –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å –ë–î                  –ò–°–ü–†–ê–í–õ–ï–ù–û
‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è            –î–û–ë–ê–í–õ–ï–ù–û (log_statement=all)
‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏            –î–û–ë–ê–í–õ–ï–ù–û
‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏   –î–û–ë–ê–í–õ–ï–ù–û
```

---

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?

### 1. –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ
git pull origin main

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ)
pnpm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ—Ä—Ç PostgreSQL –æ—Å—Ç–∞–Ω–µ—Ç—Å—è 5433 - —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è dev)
pnpm dev
```

### 2. –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º)

```bash
cd /opt/RUBLESTORE_GLOBAL

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ù–û–í–´–ï –Ω–∞–¥—ë–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
# (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ DEPLOYMENT.md)
openssl rand -base64 32  # DB_PASSWORD
openssl rand -base64 32  # PAYLOAD_SECRET
openssl rand -base64 32  # ENCRYPTION_KEY

# –û–±–Ω–æ–≤–∏—Ç—å .env —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
bash scripts/security-check.sh

# –ï—Å–ª–∏ ‚úÖ –ü–†–û–ô–î–ï–ù–´ - –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose down -v  # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ë–î —Å –ø–∞—Ä–æ–ª–µ–º "postgres"
docker compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f web
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã:**

1. **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º:**
   - –ü—Ä–æ—á–∏—Ç–∞—Ç—å [SECURITY.md](./SECURITY.md) - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–¥—É
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sql.raw()` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: `sql\`...\``

2. **DevOps / –°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:**
   - –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º [DEPLOYMENT.md](./DEPLOYMENT.md)
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å [scripts/security-check.sh](./scripts/security-check.sh)
   - –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∞—Ç–∞–∫–∞ - —Å–ª–µ–¥–æ–≤–∞—Ç—å [INCIDENT_RESPONSE.md](./INCIDENT_RESPONSE.md)

3. **–í—Å–µ:**
   - –û–±–Ω–æ–≤–∏—Ç—å .env —Å –Ω–∞–¥—ë–∂–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å .env –≤ Git
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pnpm audit`

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
pnpm dev
# –î–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
# –°–∞–π—Ç: http://localhost:3001
# API: http://localhost:4000
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
docker compose ps
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "Up"

docker compose logs web --tail 10
# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

curl http://your-domain:3001
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è HTML —Å–∞–π—Ç–∞

curl http://your-domain:4000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å API (–µ—Å–ª–∏ –µ—Å—Ç—å)
```

---

## üìû –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ PostgreSQL

```bash
docker compose logs postgres | grep -i "error\|fatal"
```

### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã

–≠—Ç–æ –±—ã–ª–æ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –¢–µ–ø–µ—Ä—å —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫:
1. –ü–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –ü–∞—Ä–æ–ª—å –Ω–∞–¥—ë–∂–Ω—ã–π (32+ —Å–∏–º–≤–æ–ª–∞)
3. SQL injection –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

1. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   ```bash
   cd apps/web
   pnpm db:migrate:refresh  # –£–¥–∞–ª–∏—Ç –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç —Å—Ö–µ–º—É
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env:
   ```bash
   cat .env | grep -E "DB_PASSWORD|PAYLOAD_SECRET"
   # –ù–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏
   ```

3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏:
   ```bash
   docker compose logs --tail 100
   ```

---

## üéì –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

**–°—Å—ã–ª–∫–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è:**

- [OWASP Top 10 - SQL Injection](https://owasp.org/www-project-top-ten/)
- [PostgreSQL Security Best Practices](https://www.postgresql.org/docs/current/sql-syntax.html)
- [Node Postgres Parameterized Queries](https://node-postgres.com/features/queries)
- [Docker Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª —ç—Ç–æ —Ä–µ–∑—é–º–µ
- [ ] –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- [ ] –í—Å–µ –ø–∞—Ä–æ–ª–∏ –≤ production –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Firewall –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (5432 –ó–ê–ö–†–´–¢)
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∫–ª—é—á—ë–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 8 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0 (Production Ready)

